<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Estimation immobili√®re gratuite | ValoMaison</title>
    <meta name="description" content="Estimez gratuitement la valeur de votre bien immobilier en 2 minutes. Bas√© sur les transactions r√©elles DVF.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ request.url_root }}estimation">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url_root }}estimation">
    <meta property="og:title" content="Estimation immobili√®re gratuite | ValoMaison">
    <meta property="og:description" content="Estimez gratuitement la valeur de votre bien immobilier en 2 minutes.">
    <meta property="og:locale" content="fr_FR">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">

    <!-- Fonts & Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app">
        <!-- Navigation -->
        <nav class="navbar">
            <a href="/" class="nav-logo">
                <span class="logo-icon">üè†</span>
                <span class="logo-text">ValoMaison</span>
            </a>
            <button class="nav-toggle" aria-label="Menu">‚ò∞</button>
            <div class="nav-links">
                <a href="/" class="nav-link">Accueil</a>
                <a href="/estimation" class="nav-link active">Estimer</a>
                <a href="/a-propos" class="nav-link">√Ä propos</a>
                <a href="/contact" class="nav-link">Contact</a>
            </div>
        </nav>

        <!-- Page Header -->
        <header class="page-header">
            <h1>Estimez votre bien immobilier</h1>
            <p>Obtenez une estimation bas√©e sur les transactions r√©elles en quelques clics</p>
        </header>

        <!-- Main Form -->
        <main class="main-content">
            <form id="estimation-form" class="estimation-form multistep-form">
                <!-- Progress Stepper simplifi√© (3 √©tapes visuelles) -->
                <div class="form-stepper form-stepper-mini">
                    <div class="stepper-step active" data-step="1">
                        <span class="stepper-number">1</span>
                        <span class="stepper-label">Votre bien</span>
                    </div>
                    <div class="stepper-line"></div>
                    <div class="stepper-step" data-step="2">
                        <span class="stepper-number">2</span>
                        <span class="stepper-label">Votre projet</span>
                    </div>
                    <div class="stepper-line"></div>
                    <div class="stepper-step" data-step="3">
                        <span class="stepper-number">3</span>
                        <span class="stepper-label">R√©sultat</span>
                    </div>
                </div>

                <!-- √âTAPE 1: Type de bien ‚Üí Auto-advance -->
                <div class="form-step active" data-step="1">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">Quel type de bien souhaitez-vous estimer ?</h2>

                        <div class="type-selector type-selector-large">
                            <label class="type-option type-option-large" data-type="appartement">
                                <input type="radio" name="type_bien" value="appartement">
                                <span class="type-icon">üè¢</span>
                                <span class="type-label">Appartement</span>
                            </label>
                            <label class="type-option type-option-large" data-type="maison">
                                <input type="radio" name="type_bien" value="maison">
                                <span class="type-icon">üè°</span>
                                <span class="type-label">Maison</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- √âTAPE 2: Code postal ‚Üí Auto-advance √† 5 chiffres -->
                <div class="form-step" data-step="2">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">O√π se situe votre bien ?</h2>

                        <div class="input-group input-group-centered">
                            <input type="text" id="code_postal" name="code_postal"
                                   placeholder="Code postal (ex: 75001)"
                                   pattern="[0-9]{5}" maxlength="5" required
                                   inputmode="numeric" autocomplete="postal-code"
                                   class="input-large input-centered">
                        </div>

                        <button type="button" class="nav-btn-back" onclick="prevStep()">
                            ‚Üê Retour
                        </button>
                    </div>
                </div>

                <!-- √âTAPE 3: Surface (boutons) ‚Üí Auto-advance -->
                <div class="form-step" data-step="3">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">Quelle est la surface de votre bien ?</h2>

                        <div class="surface-selector">
                            <label class="surface-option" data-surface="25">
                                <input type="radio" name="surface_range" value="25">
                                <span class="surface-label">Moins de 30 m¬≤</span>
                            </label>
                            <label class="surface-option" data-surface="40">
                                <input type="radio" name="surface_range" value="40">
                                <span class="surface-label">30 - 50 m¬≤</span>
                            </label>
                            <label class="surface-option" data-surface="65">
                                <input type="radio" name="surface_range" value="65">
                                <span class="surface-label">50 - 80 m¬≤</span>
                            </label>
                            <label class="surface-option" data-surface="100">
                                <input type="radio" name="surface_range" value="100">
                                <span class="surface-label">80 - 120 m¬≤</span>
                            </label>
                            <label class="surface-option" data-surface="150">
                                <input type="radio" name="surface_range" value="150">
                                <span class="surface-label">120 - 180 m¬≤</span>
                            </label>
                            <label class="surface-option" data-surface="220">
                                <input type="radio" name="surface_range" value="220">
                                <span class="surface-label">Plus de 180 m¬≤</span>
                            </label>
                        </div>

                        <!-- Champ cach√© pour la surface -->
                        <input type="hidden" id="surface" name="surface" value="65">
                        <input type="hidden" id="nb_pieces" name="nb_pieces" value="3">

                        <button type="button" class="nav-btn-back" onclick="prevStep()">
                            ‚Üê Retour
                        </button>
                    </div>
                </div>

                <!-- √âTAPE 4: Surface terrain (MAISON uniquement) ‚Üí Auto-advance -->
                <div class="form-step" data-step="4">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">Quelle est la surface du terrain ?</h2>

                        <div class="surface-selector terrain-selector">
                            <label class="surface-option" data-terrain="200">
                                <input type="radio" name="terrain_range" value="200">
                                <span class="surface-label">Moins de 300 m¬≤</span>
                            </label>
                            <label class="surface-option" data-terrain="400">
                                <input type="radio" name="terrain_range" value="400">
                                <span class="surface-label">300 - 500 m¬≤</span>
                            </label>
                            <label class="surface-option" data-terrain="700">
                                <input type="radio" name="terrain_range" value="700">
                                <span class="surface-label">500 - 1000 m¬≤</span>
                            </label>
                            <label class="surface-option" data-terrain="1500">
                                <input type="radio" name="terrain_range" value="1500">
                                <span class="surface-label">1000 - 2000 m¬≤</span>
                            </label>
                            <label class="surface-option" data-terrain="3000">
                                <input type="radio" name="terrain_range" value="3000">
                                <span class="surface-label">2000 - 5000 m¬≤</span>
                            </label>
                            <label class="surface-option" data-terrain="7000">
                                <input type="radio" name="terrain_range" value="7000">
                                <span class="surface-label">Plus de 5000 m¬≤</span>
                            </label>
                        </div>

                        <!-- Champ cach√© pour la surface terrain -->
                        <input type="hidden" id="surface_terrain" name="surface_terrain" value="">

                        <button type="button" class="nav-btn-back" onclick="prevStep()">
                            ‚Üê Retour
                        </button>
                    </div>
                </div>

                <!-- √âTAPE 5: Projet de vente (qualification) ‚Üí Auto-advance -->
                <div class="form-step" data-step="5">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">Quand souhaitez-vous vendre ?</h2>

                        <div class="timeline-selector">
                            <label class="timeline-option" data-timeline="moins_3_mois">
                                <input type="radio" name="quand_vendre" value="moins_3_mois">
                                <span class="timeline-icon">üöÄ</span>
                                <span class="timeline-label">Moins de 3 mois</span>
                            </label>
                            <label class="timeline-option" data-timeline="3_6_mois">
                                <input type="radio" name="quand_vendre" value="3_6_mois">
                                <span class="timeline-icon">üìÖ</span>
                                <span class="timeline-label">3 √† 6 mois</span>
                            </label>
                            <label class="timeline-option" data-timeline="plus_6_mois">
                                <input type="radio" name="quand_vendre" value="plus_6_mois">
                                <span class="timeline-icon">üìÜ</span>
                                <span class="timeline-label">Plus de 6 mois</span>
                            </label>
                            <label class="timeline-option" data-timeline="curieux">
                                <input type="radio" name="quand_vendre" value="curieux">
                                <span class="timeline-icon">üîç</span>
                                <span class="timeline-label">Juste curieux</span>
                            </label>
                        </div>

                        <button type="button" class="nav-btn-back" onclick="prevStep()">
                            ‚Üê Retour
                        </button>
                    </div>
                </div>

                <!-- √âTAPE 6: Coordonn√©es ‚Üí Bouton "Voir mon estimation" -->
                <div class="form-step" data-step="6">
                    <div class="form-card form-card-centered">
                        <h2 class="step-title">Derni√®re √©tape !</h2>
                        <p class="step-subtitle">Entrez vos coordonn√©es pour voir votre estimation</p>

                        <div class="lead-form-inline">
                            <div class="input-group">
                                <input type="text" id="lead-nom" name="lead_nom"
                                       placeholder="Votre nom *" required class="input-modern">
                            </div>
                            <div class="input-group">
                                <input type="email" id="lead-email" name="lead_email"
                                       placeholder="Votre email *" required class="input-modern">
                            </div>
                            <div class="input-group">
                                <input type="tel" id="lead-telephone" name="lead_telephone"
                                       placeholder="Votre t√©l√©phone *" required
                                       pattern="^(\+33|0)[1-9](\s?[0-9]{2}){4}$"
                                       class="input-modern">
                            </div>
                        </div>

                        <label class="consent-checkbox">
                            <input type="checkbox" id="lead-consent" name="lead_consent" required>
                            <span>J'accepte d'√™tre recontact√© par ValoMaison</span>
                        </label>

                        <button type="submit" class="submit-btn submit-btn-large">
                            <span class="btn-text">Voir mon estimation</span>
                            <span class="btn-icon">‚Üí</span>
                        </button>

                        <button type="button" class="nav-btn-back" onclick="prevStep()">
                            ‚Üê Retour
                        </button>
                    </div>
                </div>
            </form>

            <!-- Results Section -->
            <div id="results" class="results-section hidden">
                <div class="results-card">
                    <div class="results-header">
                        <h2>Estimation de votre bien</h2>
                        <button type="button" class="close-btn" onclick="closeResults()">√ó</button>
                    </div>

                    <div id="zone-info" class="zone-alert hidden">
                        <span class="zone-icon">i</span>
                        <span id="zone-message"></span>
                    </div>

                    <div class="price-display">
                        <div class="price-range">
                            <div class="price-item price-low">
                                <span class="price-label">Estimation basse</span>
                                <span class="price-value" id="result-low"><span class="skeleton skeleton-price"></span></span>
                            </div>
                            <div class="price-item price-main">
                                <span class="price-label">Estimation</span>
                                <span class="price-value" id="result-mid"><span class="skeleton skeleton-price-main"></span></span>
                                <span class="price-badge">Valeur probable</span>
                            </div>
                            <div class="price-item price-high">
                                <span class="price-label">Estimation haute</span>
                                <span class="price-value" id="result-high"><span class="skeleton skeleton-price"></span></span>
                            </div>
                        </div>
                    </div>

                    <div class="details-grid">
                        <div class="detail-card">
                            <span class="detail-icon">üìä</span>
                            <span class="detail-label">Prix/m¬≤ zone</span>
                            <span class="detail-value" id="result-price-zone"><span class="skeleton skeleton-detail"></span></span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-icon">üéØ</span>
                            <span class="detail-label">Prix/m¬≤ ajust√©</span>
                            <span class="detail-value" id="result-price-adjusted"><span class="skeleton skeleton-detail"></span></span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-icon">üìà</span>
                            <span class="detail-label">Ajustement</span>
                            <span class="detail-value" id="result-adjustment"><span class="skeleton skeleton-detail"></span></span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-icon">üèòÔ∏è</span>
                            <span class="detail-label">Transactions</span>
                            <span class="detail-value" id="result-transactions"><span class="skeleton skeleton-detail"></span></span>
                        </div>
                        <div class="detail-card">
                            <span class="detail-icon">‚≠ê</span>
                            <span class="detail-label">Confiance</span>
                            <span class="detail-value" id="result-confidence"><span class="skeleton skeleton-detail"></span></span>
                        </div>
                    </div>

                    <details class="adjustments-details">
                        <summary>Voir le detail des ajustements</summary>
                        <ul id="adjustments-list" class="adjustments-list"></ul>
                    </details>

                    <div class="disclaimer">
                        <strong>Note :</strong> Cette estimation est bas√©e sur les donn√©es DVF
                        (transactions r√©elles). Elle est indicative et ne remplace pas l'avis d'un professionnel.
                    </div>

                    <button type="button" class="new-estimation-btn" onclick="newEstimation()">
                        Nouvelle estimation
                    </button>
                </div>

                <!-- Conversion Section (shown first) -->
                <div id="conversion-section" class="conversion-section hidden">
                    <div class="conversion-card">
                        <!-- Estimation Preview -->
                        <div class="estimation-ready-banner">
                            <div class="ready-icon">‚úì</div>
                            <div class="ready-text">
                                <h2>Votre estimation est pr√™te !</h2>
                                <p>Valeur estim√©e de votre bien</p>
                            </div>
                        </div>

                        <div class="estimation-preview">
                            <div class="preview-price" id="preview-price">--- --- ‚Ç¨</div>
                            <div class="preview-blur-overlay">
                                <span>üîí</span>
                            </div>
                        </div>

                        <!-- Upsell Section -->
                        <div class="upsell-section">
                            <h3>üìà Optimisez votre estimation gratuitement</h3>
                            <p>Un conseiller expert peut affiner ce r√©sultat et vous faire gagner en moyenne <strong>+8%</strong> sur le prix de vente.</p>

                            <div class="upsell-benefits">
                                <div class="benefit-item">
                                    <span class="benefit-check">‚úì</span>
                                    <span>Analyse personnalis√©e de votre bien</span>
                                </div>
                                <div class="benefit-item">
                                    <span class="benefit-check">‚úì</span>
                                    <span>Conseils pour maximiser la valeur</span>
                                </div>
                                <div class="benefit-item">
                                    <span class="benefit-check">‚úì</span>
                                    <span>100% gratuit, sans engagement</span>
                                </div>
                            </div>

                            <div id="cta-options" class="cta-options">
                                <button type="button" class="cta-card cta-primary" onclick="showCallbackForm()">
                                    <span class="cta-icon">üìû</span>
                                    <div class="cta-content">
                                        <strong>√ätre rappel√©</strong>
                                        <span>Par un expert immobilier</span>
                                    </div>
                                </button>
                                <button type="button" class="cta-card" onclick="showVisitForm()">
                                    <span class="cta-icon">üè†</span>
                                    <div class="cta-content">
                                        <strong>Visite gratuite</strong>
                                        <span>Estimation √† domicile</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <button type="button" id="skip-conversion-btn" class="skip-btn" onclick="skipToEstimation()">
                            Non merci, voir directement mon estimation ‚Üí
                        </button>

                    <!-- Callback Form -->
                    <div id="callback-form-container" class="lead-form-container hidden">
                        <button type="button" class="back-btn" onclick="hideLeadForms()">Retour</button>
                        <h4>Demande de rappel</h4>
                        <p>Un conseiller vous contactera pour r√©pondre √† vos questions.</p>
                        <form id="callback-form" class="lead-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="callback-nom">Nom *</label>
                                    <input type="text" id="callback-nom" name="nom" required>
                                </div>
                                <div class="form-group">
                                    <label for="callback-prenom">Pr√©nom *</label>
                                    <input type="text" id="callback-prenom" name="prenom" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="callback-tel">T√©l√©phone *</label>
                                <input type="tel" id="callback-tel" name="telephone" placeholder="06 12 34 56 78"
                                       pattern="^(\+33|0)[1-9](\s?[0-9]{2}){4}$"
                                       title="Format: 0612345678 ou +33612345678" required>
                            </div>
                            <div class="form-group">
                                <label for="callback-email">Email</label>
                                <input type="email" id="callback-email" name="email" placeholder="optionnel">
                            </div>
                            <div class="form-group">
                                <label for="callback-horaires">Horaires de disponibilit√©</label>
                                <select id="callback-horaires" name="horaires">
                                    <option value="matin">Le matin (9h-12h)</option>
                                    <option value="midi">Le midi (12h-14h)</option>
                                    <option value="aprem" selected>L'apr√®s-midi (14h-18h)</option>
                                    <option value="soir">En soir√©e (18h-20h)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="callback-projet">Votre projet</label>
                                <select id="callback-projet" name="projet">
                                    <option value="vente">Je souhaite vendre</option>
                                    <option value="estimation">Simple curiosit√© / estimation</option>
                                    <option value="succession">Succession / Partage</option>
                                    <option value="investissement">Projet d'investissement</option>
                                </select>
                            </div>
                            <label class="consent-checkbox">
                                <input type="checkbox" name="consent" required>
                                <span>J'accepte d'√™tre recontact√© par ValoMaison. <a href="/politique-confidentialite" target="_blank">Politique de confidentialit√©</a></span>
                            </label>
                            <button type="submit" class="btn-primary btn-full">Demander un rappel</button>
                        </form>
                    </div>

                    <!-- Visit Form -->
                    <div id="visit-form-container" class="lead-form-container hidden">
                        <button type="button" class="back-btn" onclick="hideLeadForms()">Retour</button>
                        <h4>Planifier une visite d'estimation</h4>
                        <p>Un conseiller se d√©place gratuitement pour √©valuer votre bien sur place.</p>
                        <form id="visit-form" class="lead-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="visit-nom">Nom *</label>
                                    <input type="text" id="visit-nom" name="nom" required>
                                </div>
                                <div class="form-group">
                                    <label for="visit-prenom">Pr√©nom *</label>
                                    <input type="text" id="visit-prenom" name="prenom" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="visit-tel">T√©l√©phone *</label>
                                    <input type="tel" id="visit-tel" name="telephone" placeholder="06 12 34 56 78"
                                           pattern="^(\+33|0)[1-9](\s?[0-9]{2}){4}$"
                                           title="Format: 0612345678 ou +33612345678" required>
                                </div>
                                <div class="form-group">
                                    <label for="visit-email">Email *</label>
                                    <input type="email" id="visit-email" name="email" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="visit-adresse">Adresse du bien *</label>
                                <input type="text" id="visit-adresse" name="adresse" placeholder="Rue, num√©ro" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="visit-date">Date souhait√©e *</label>
                                    <input type="date" id="visit-date" name="date" required>
                                </div>
                                <div class="form-group">
                                    <label for="visit-creneau">Cr√©neau</label>
                                    <select id="visit-creneau" name="creneau">
                                        <option value="matin">Matin (9h-12h)</option>
                                        <option value="aprem" selected>Apr√®s-midi (14h-18h)</option>
                                        <option value="soir">Soir√©e (18h-20h)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="visit-message">Message (optionnel)</label>
                                <textarea id="visit-message" name="message" rows="3" placeholder="Informations compl√©mentaires sur votre bien ou votre projet..."></textarea>
                            </div>
                            <label class="consent-checkbox">
                                <input type="checkbox" name="consent" required>
                                <span>J'accepte d'√™tre recontact√© par ValoMaison. <a href="/politique-confidentialite" target="_blank">Politique de confidentialit√©</a></span>
                            </label>
                            <button type="submit" class="btn-primary btn-full">Planifier la visite</button>
                        </form>
                    </div>

                    <!-- Success Message -->
                    <div id="lead-success" class="lead-success hidden">
                        <div class="success-content">
                            <span class="success-icon-large">‚úì</span>
                            <h4>Demande envoy√©e !</h4>
                            <p id="success-message">Un conseiller vous contactera tr√®s prochainement.</p>
                        </div>
                    </div>

                    <p class="trust-note">Plus de 500 propri√©taires accompagn√©s cette ann√©e</p>
                </div>
            </div>

            <!-- Error Section -->
            <div id="error-message" class="error-section hidden">
                <div class="error-card">
                    <span class="error-icon">!</span>
                    <p id="error-text"></p>
                    <button type="button" onclick="closeError()">Reessayer</button>
                </div>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading-overlay hidden">
                <div class="loading-content">
                    <div class="loading-house">
                        <div class="house-icon">üè†</div>
                        <div class="loading-bar">
                            <div class="loading-progress"></div>
                        </div>
                    </div>
                    <p class="loading-text">Analyse des transactions en cours...</p>
                    <p class="loading-subtext">Calcul de l'estimation bas√©e sur les ventes r√©elles</p>
                </div>
            </div>
        </main>

        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="logo-icon">üè†</span>
                    <span class="logo-text">ValoMaison</span>
                </div>
                <div class="footer-links">
                    <a href="/">Accueil</a>
                    <a href="/estimation">Estimer</a>
                    <a href="/a-propos">A propos</a>
                    <a href="/contact">Contact</a>
                </div>
                <div class="footer-legal-links">
                    <a href="/mentions-legales">Mentions legales</a>
                    <a href="/cgu">CGU</a>
                    <a href="/politique-confidentialite">Confidentialite</a>
                </div>
                <p class="footer-legal">Donnees DVF - data.gouv.fr</p>
            </div>
        </footer>
    </div>

    <script>
        // Multi-step form navigation - 6 √©tapes avec auto-advance
        let currentStep = 1;
        const totalSteps = 6;
        let isCurieux = false; // Flag pour les curieux
        let isMaison = false;  // Flag pour maison (affiche √©tape terrain)

        // Logging helper avec num√©ro d'√©tape
        function log(message, data = null) {
            const timestamp = new Date().toISOString().substr(11, 12);
            const stepInfo = `[√âtape ${currentStep}/${totalSteps}]`;
            if (data) {
                console.log(`[${timestamp}] ${stepInfo} ${message}`, data);
            } else {
                console.log(`[${timestamp}] ${stepInfo} ${message}`);
            }
        }

        log('Formulaire 6 √©tapes initialis√©');

        const stepNames = {
            1: 'Type de bien',
            2: 'Code postal',
            3: 'Surface',
            4: 'Terrain',
            5: 'Projet',
            6: 'Coordonn√©es'
        };

        // Mapping: 6 √©tapes r√©elles ‚Üí 3 √©tapes visuelles
        // √âtapes 1-4 (Bien, Lieu, Surface, Terrain) ‚Üí Stepper 1 "Votre bien"
        // √âtape 5 (Projet) ‚Üí Stepper 2 "Votre projet"
        // √âtape 6 (Contact) ‚Üí Stepper 3 "R√©sultat"
        function getVisualStep(realStep) {
            if (realStep <= 4) return 1;
            if (realStep === 5) return 2;
            return 3;
        }

        function updateStepper() {
            const visualStep = getVisualStep(currentStep);

            document.querySelectorAll('.stepper-step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                if (stepNum === visualStep) {
                    step.classList.add('active');
                } else if (stepNum < visualStep) {
                    step.classList.add('completed');
                }
            });

            document.querySelectorAll('.stepper-line').forEach((line, index) => {
                if (index < visualStep - 1) {
                    line.classList.add('completed');
                } else {
                    line.classList.remove('completed');
                }
            });

            log(`Stepper mis √† jour (visuel: ${visualStep}/3)`);
        }

        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
            const targetStep = document.querySelector(`.form-step[data-step="${step}"]`);
            if (targetStep) {
                targetStep.classList.add('active');
                log(`Affichage: ${stepNames[step]}`);
            }
            updateStepper();

            // Tracker l'√©tape
            if (window.EITracker && window.EITracker.trackFormStep) {
                window.EITracker.trackFormStep(step, stepNames[step], {});
            }

            // Scroll to top
            document.querySelector('.form-stepper').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                // Skip √©tape 4 (terrain) si c'est un appartement
                if (currentStep === 4 && !isMaison) {
                    currentStep = 3;
                }
                log(`Retour vers √©tape ${currentStep}`);
                showStep(currentStep);
            }
        }

        // ========== √âTAPE 1: Type de bien - Auto-advance ==========
        document.querySelectorAll('.type-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.type-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');

                const type = this.dataset.type;
                isMaison = (type === 'maison');
                log(`Type s√©lectionn√©: ${type} (isMaison: ${isMaison})`);

                // Auto-advance vers √©tape 2
                if (currentStep === 1) {
                    setTimeout(() => {
                        currentStep = 2;
                        showStep(2);
                        document.getElementById('code_postal').focus();
                    }, 200);
                }
            });
        });

        // ========== √âTAPE 2: Code postal - Auto-advance √† 5 chiffres ==========
        document.getElementById('code_postal').addEventListener('input', function() {
            const value = this.value.trim();

            if (/^[0-9]{5}$/.test(value) && currentStep === 2) {
                log(`Code postal valide: ${value}`);
                setTimeout(() => {
                    currentStep = 3;
                    showStep(3);
                }, 300);
            }
        });

        // ========== √âTAPE 3: Surface (boutons) - Auto-advance ==========
        document.querySelectorAll('.surface-option:not([data-terrain])').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.surface-option:not([data-terrain])').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');

                const surface = this.dataset.surface;
                document.getElementById('surface').value = surface;

                // Estimer nb_pieces bas√© sur surface
                let nbPieces = 2;
                if (surface >= 40) nbPieces = 2;
                if (surface >= 65) nbPieces = 3;
                if (surface >= 100) nbPieces = 4;
                if (surface >= 150) nbPieces = 5;
                if (surface >= 220) nbPieces = 6;
                document.getElementById('nb_pieces').value = nbPieces;

                log(`Surface s√©lectionn√©e: ${surface}m¬≤ (~${nbPieces} pi√®ces)`);

                // Auto-advance: maison ‚Üí √©tape 4 (terrain), appartement ‚Üí √©tape 5 (projet)
                if (currentStep === 3) {
                    setTimeout(() => {
                        if (isMaison) {
                            currentStep = 4;
                            showStep(4);
                        } else {
                            currentStep = 5;
                            showStep(5);
                        }
                    }, 200);
                }
            });
        });

        // ========== √âTAPE 4: Terrain (MAISON) - Auto-advance ==========
        document.querySelectorAll('.surface-option[data-terrain]').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.surface-option[data-terrain]').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');

                const terrain = this.dataset.terrain;
                document.getElementById('surface_terrain').value = terrain;

                log(`Terrain s√©lectionn√©: ${terrain}m¬≤`);

                // Auto-advance vers √©tape 5 (projet)
                if (currentStep === 4) {
                    setTimeout(() => {
                        currentStep = 5;
                        showStep(5);
                    }, 200);
                }
            });
        });

        // ========== √âTAPE 5: Projet - Auto-advance ==========
        document.querySelectorAll('.timeline-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.timeline-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');

                const timeline = this.dataset.timeline;
                log(`Projet s√©lectionn√©: ${timeline}`);

                // Si "curieux", aller directement √† l'estimation sans coordonn√©es
                if (timeline === 'curieux') {
                    isCurieux = true;
                    log('Mode curieux: estimation directe sans lead');
                    setTimeout(() => {
                        submitEstimationDirect();
                    }, 300);
                } else {
                    isCurieux = false;
                    // Auto-advance vers √©tape 6 (contact)
                    if (currentStep === 5) {
                        setTimeout(() => {
                            currentStep = 6;
                            showStep(6);
                            document.getElementById('lead-nom').focus();
                        }, 200);
                    }
                }
            });
        });

        // ========== Estimation directe (curieux) ==========
        async function submitEstimationDirect() {
            const form = document.getElementById('estimation-form');
            const results = document.getElementById('results');
            const error = document.getElementById('error-message');

            // Validation basique
            const typeBien = document.querySelector('input[name="type_bien"]:checked');
            const codePostal = document.getElementById('code_postal').value;
            const surface = document.getElementById('surface').value;
            const surfaceTerrain = document.getElementById('surface_terrain').value;

            if (!typeBien || !codePostal || !surface) {
                alert('Veuillez compl√©ter toutes les √©tapes.');
                return;
            }

            log('Soumission directe (curieux)');

            // Cacher le formulaire, afficher les r√©sultats
            form.classList.add('hidden');
            error.classList.add('hidden');
            resetToSkeletons();
            document.querySelector('.results-card').classList.remove('hidden');
            results.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Pr√©parer les donn√©es
            const data = {
                type_bien: typeBien.value,
                code_postal: codePostal,
                surface: parseFloat(surface),
                nb_pieces: parseInt(document.getElementById('nb_pieces').value),
                etat_general: 'bon'
            };

            // Ajouter surface terrain pour les maisons
            if (isMaison && surfaceTerrain) {
                data.surface_terrain = parseFloat(surfaceTerrain);
            }

            log('Donn√©es estimation:', data);

            try {
                const response = await fetch('/api/estimate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                log('R√©ponse API:', result);

                if (result.erreur) {
                    form.classList.remove('hidden');
                    results.classList.add('hidden');
                    document.getElementById('error-text').textContent = result.message;
                    error.classList.remove('hidden');
                } else {
                    displayResults(result);
                    // Pas d'envoi de lead pour les curieux
                    log('Estimation affich√©e (mode curieux, pas de lead)');
                }
            } catch (err) {
                log('Erreur:', err);
                form.classList.remove('hidden');
                results.classList.add('hidden');
                document.getElementById('error-text').textContent = 'Erreur de connexion.';
                error.classList.remove('hidden');
            }
        }

        // ========== √âTAPE 6: Soumission ==========
        async function submitEstimation() {
            const form = document.getElementById('estimation-form');
            const results = document.getElementById('results');
            const error = document.getElementById('error-message');

            // Validation basique
            const typeBien = document.querySelector('input[name="type_bien"]:checked');
            const codePostal = document.getElementById('code_postal').value;
            const surface = document.getElementById('surface').value;
            const surfaceTerrain = document.getElementById('surface_terrain').value;
            const leadNom = document.getElementById('lead-nom').value;
            const leadEmail = document.getElementById('lead-email').value;
            const leadTel = document.getElementById('lead-telephone').value;
            const consent = document.getElementById('lead-consent').checked;

            if (!typeBien || !codePostal || !surface) {
                alert('Veuillez compl√©ter toutes les √©tapes.');
                return;
            }

            if (!leadNom || !leadEmail || !leadTel) {
                alert('Veuillez remplir vos coordonn√©es.');
                return;
            }

            if (!consent) {
                alert('Veuillez accepter les conditions.');
                return;
            }

            // Cacher le formulaire, afficher les r√©sultats
            form.classList.add('hidden');
            error.classList.add('hidden');
            resetToSkeletons();
            document.querySelector('.results-card').classList.remove('hidden');
            results.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Pr√©parer les donn√©es
            const data = {
                type_bien: typeBien.value,
                code_postal: codePostal,
                surface: parseFloat(surface),
                nb_pieces: parseInt(document.getElementById('nb_pieces').value),
                etat_general: 'bon'
            };

            // Ajouter surface terrain pour les maisons
            if (isMaison && surfaceTerrain) {
                data.surface_terrain = parseFloat(surfaceTerrain);
            }

            log('Donn√©es estimation:', data);

            try {
                const response = await fetch('/api/estimate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                log('R√©ponse API:', result);

                if (result.erreur) {
                    form.classList.remove('hidden');
                    results.classList.add('hidden');
                    document.getElementById('error-text').textContent = result.message;
                    error.classList.remove('hidden');
                } else {
                    displayResults(result);

                    // Envoyer le lead
                    const timeline = document.querySelector('input[name="quand_vendre"]:checked');
                    const leadData = {
                        type: 'callback',
                        nom: leadNom,
                        telephone: leadTel,
                        email: leadEmail,
                        projet: 'vente',
                        horaires: 'aprem',
                        notes: timeline ? `D√©lai: ${timeline.value}` : '',
                        estimation_data: {
                            code_postal: codePostal,
                            type_bien: typeBien.value,
                            surface: data.surface,
                            estimation_moyenne: result.estimation_moyenne
                        }
                    };

                    log('Envoi lead:', leadData);
                    fetch('/api/leads', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(leadData)
                    }).then(r => r.json()).then(r => log('Lead enregistr√©:', r));
                }
            } catch (err) {
                log('Erreur:', err);
                form.classList.remove('hidden');
                results.classList.add('hidden');
                document.getElementById('error-text').textContent = 'Erreur de connexion.';
                error.classList.remove('hidden');
            }
        }

        // Form submission
        document.getElementById('estimation-form').addEventListener('submit', function(e) {
            e.preventDefault();
            log('Soumission formulaire');
            submitEstimation();
        });

        function displayResults(result) {
            const formatPrice = (price) => new Intl.NumberFormat('fr-FR', {
                style: 'currency', currency: 'EUR', maximumFractionDigits: 0
            }).format(price);

            document.getElementById('result-low').textContent = formatPrice(result.estimation_basse);
            document.getElementById('result-mid').textContent = formatPrice(result.estimation_moyenne);
            document.getElementById('result-high').textContent = formatPrice(result.estimation_haute);
            document.getElementById('result-price-zone').textContent = formatPrice(result.prix_m2_zone) + '/m¬≤';
            document.getElementById('result-price-adjusted').textContent = formatPrice(result.prix_m2_ajuste) + '/m¬≤';
            document.getElementById('result-adjustment').textContent = result.ajustement_total;
            document.getElementById('result-transactions').textContent = result.nb_transactions_reference;

            const confidenceLabels = {
                'haute': 'Haute',
                'moyenne': 'Moyenne',
                'faible': 'Faible',
                'tres_faible': 'Tres faible'
            };
            document.getElementById('result-confidence').textContent = confidenceLabels[result.confiance] || result.confiance;

            // Zone info
            const zoneInfo = document.getElementById('zone-info');
            if (result.zone_elargie) {
                document.getElementById('zone-message').textContent = result.message_zone;
                zoneInfo.classList.remove('hidden');
            } else {
                zoneInfo.classList.add('hidden');
            }

            // Adjustments
            const list = document.getElementById('adjustments-list');
            list.innerHTML = '';

            const labels = {
                'etage': '√âtage', 'ascenseur': 'Ascenseur', 'etat': '√âtat',
                'balcon_terrasse': 'Balcon/Terrasse', 'parking': 'Parking',
                'cave': 'Cave', 'jardin': 'Jardin', 'dpe': 'DPE',
                'exposition': 'Exposition', 'vue': 'Vue', 'standing': 'Standing',
                'veranda': 'V√©randa', 'dependances': 'D√©pendances',
                'cuisine_equipee': 'Cuisine √©quip√©e', 'double_vitrage': 'Double vitrage',
                'climatisation': 'Climatisation', 'cheminee': 'Chemin√©e',
                'parquet': 'Parquet', 'fibre': 'Fibre optique',
                'alarme': 'Alarme', 'digicode': 'Digicode', 'gardien': 'Gardien',
                'portail_auto': 'Portail auto', 'piscine': 'Piscine', 'potager': 'Potager',
                'spa': 'Spa/Jacuzzi', 'terrain_tennis': 'Tennis',
                'abri_jardin': 'Abri jardin', 'arrosage_auto': 'Arrosage auto'
            };

            for (const [key, value] of Object.entries(result.ajustements)) {
                const li = document.createElement('li');
                li.innerHTML = `<span>${labels[key] || key}</span><span class="${value.startsWith('+') ? 'positive' : 'negative'}">${value}</span>`;
                list.appendChild(li);
            }

            if (result.valeur_terrain) {
                const li = document.createElement('li');
                li.innerHTML = `<span>Valeur terrain</span><span>${formatPrice(result.valeur_terrain)}</span>`;
                list.appendChild(li);
            }
        }

        function resetToSkeletons() {
            // Remettre les skeletons dans les valeurs
            document.getElementById('result-low').innerHTML = '<span class="skeleton skeleton-price"></span>';
            document.getElementById('result-mid').innerHTML = '<span class="skeleton skeleton-price-main"></span>';
            document.getElementById('result-high').innerHTML = '<span class="skeleton skeleton-price"></span>';
            document.getElementById('result-price-zone').innerHTML = '<span class="skeleton skeleton-detail"></span>';
            document.getElementById('result-price-adjusted').innerHTML = '<span class="skeleton skeleton-detail"></span>';
            document.getElementById('result-adjustment').innerHTML = '<span class="skeleton skeleton-detail"></span>';
            document.getElementById('result-transactions').innerHTML = '<span class="skeleton skeleton-detail"></span>';
            document.getElementById('result-confidence').innerHTML = '<span class="skeleton skeleton-detail"></span>';
            document.getElementById('adjustments-list').innerHTML = '';
        }

        function closeResults() {
            document.getElementById('results').classList.add('hidden');
        }

        function closeError() {
            document.getElementById('error-message').classList.add('hidden');
        }

        function newEstimation() {
            // Cacher les r√©sultats
            document.getElementById('results').classList.add('hidden');
            document.querySelector('.results-card').classList.add('hidden');
            const conversionSection = document.getElementById('conversion-section');
            if (conversionSection) conversionSection.classList.add('hidden');
            // Reset conversion section elements
            const estimationBanner = document.querySelector('.estimation-ready-banner');
            const estimationPreview = document.querySelector('.estimation-preview');
            const upsellSection = document.querySelector('.upsell-section');
            const skipBtn = document.getElementById('skip-conversion-btn');
            if (estimationBanner) estimationBanner.classList.remove('hidden');
            if (estimationPreview) estimationPreview.classList.remove('hidden');
            if (upsellSection) upsellSection.classList.remove('hidden');
            if (skipBtn) skipBtn.classList.remove('hidden');

            // R√©afficher le formulaire
            const form = document.getElementById('estimation-form');
            form.classList.remove('hidden');
            form.reset();
            resetLeadForms();

            // Reset multi-step form to step 1
            currentStep = 1;
            showStep(1);
            // Reset type selector to appartement
            document.querySelectorAll('.type-option:not(.timeline-option)').forEach(o => o.classList.remove('selected'));
            document.querySelector('.type-option[data-type="appartement"]').classList.add('selected');
            document.getElementById('appart-fields').classList.remove('hidden');
            document.getElementById('maison-fields').classList.add('hidden');
            document.getElementById('maison-premium').classList.add('hidden');
            // Reset √©tape 6 et 7
            document.querySelectorAll('.timeline-option').forEach(o => o.classList.remove('selected'));
            document.getElementById('step6-next-btn').disabled = true;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function skipToEstimation() {
            // Track skip
            if (window.EITracker && window.EITracker.track) {
                window.EITracker.track('estimation_skip');
            }
            // Hide conversion section, show results
            document.getElementById('conversion-section').classList.add('hidden');
            document.querySelector('.results-card').classList.remove('hidden');
            document.querySelector('.results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
            // Track estimation view
            if (window.EITracker && window.EITracker.track) {
                window.EITracker.track('estimation_view', {
                    estimation_moyenne: window.currentEstimationResult?.estimation_moyenne
                });
            }
        }

        // Lead form functions
        function showCallbackForm() {
            // Track callback click
            if (window.EITracker && window.EITracker.track) {
                window.EITracker.track('callback_click');
            }
            document.querySelector('.estimation-ready-banner').classList.add('hidden');
            document.querySelector('.estimation-preview').classList.add('hidden');
            document.querySelector('.upsell-section').classList.add('hidden');
            document.getElementById('skip-conversion-btn').classList.add('hidden');
            document.getElementById('callback-form-container').classList.remove('hidden');
        }

        function showVisitForm() {
            // Track visit click
            if (window.EITracker && window.EITracker.track) {
                window.EITracker.track('visit_click');
            }
            document.querySelector('.estimation-ready-banner').classList.add('hidden');
            document.querySelector('.estimation-preview').classList.add('hidden');
            document.querySelector('.upsell-section').classList.add('hidden');
            document.getElementById('skip-conversion-btn').classList.add('hidden');
            document.getElementById('visit-form-container').classList.remove('hidden');
            // Set min date to today
            document.getElementById('visit-date').min = new Date().toISOString().split('T')[0];
        }

        function hideLeadForms() {
            document.getElementById('callback-form-container').classList.add('hidden');
            document.getElementById('visit-form-container').classList.add('hidden');
            document.querySelector('.estimation-ready-banner').classList.remove('hidden');
            document.querySelector('.estimation-preview').classList.remove('hidden');
            document.querySelector('.upsell-section').classList.remove('hidden');
            document.getElementById('skip-conversion-btn').classList.remove('hidden');
        }

        function resetLeadForms() {
            hideLeadForms();
            document.getElementById('lead-success').classList.add('hidden');
            document.getElementById('callback-form').reset();
            document.getElementById('visit-form').reset();
        }

        // Get current estimation data
        function getCurrentEstimation() {
            return {
                code_postal: document.getElementById('code_postal').value,
                type_bien: document.querySelector('input[name="type_bien"]:checked')?.value,
                surface: document.getElementById('surface').value,
                nb_pieces: document.getElementById('nb_pieces').value,
                estimation_basse: document.getElementById('result-low').textContent,
                estimation_moyenne: document.getElementById('result-mid').textContent,
                estimation_haute: document.getElementById('result-high').textContent
            };
        }

        // Callback form submission
        document.getElementById('callback-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            log('Soumission formulaire callback...');

            const formData = new FormData(this);
            const data = {
                type: 'callback',
                nom: formData.get('nom'),
                prenom: formData.get('prenom'),
                telephone: formData.get('telephone'),
                email: formData.get('email') || null,
                horaires: formData.get('horaires'),
                projet: formData.get('projet'),
                estimation_data: getCurrentEstimation(),
                date_demande: new Date().toISOString()
            };

            log('Donn√©es lead callback:', data);

            try {
                // Send to backend API
                log('Envoi vers /api/leads...');
                const response = await fetch('/api/leads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                log('R√©ponse /api/leads:', result);

                if (!response.ok) throw new Error(result.message || 'Erreur serveur');

                // Track callback submit
                if (window.EITracker && window.EITracker.track) {
                    window.EITracker.track('callback_submit', { projet: data.projet });
                }

                // Show success then estimation
                document.getElementById('callback-form-container').classList.add('hidden');
                document.getElementById('lead-success').classList.remove('hidden');
                document.getElementById('success-message').textContent =
                    'Un conseiller vous rappellera sur le ' + data.telephone;

                // Show estimation after delay
                setTimeout(function() {
                    document.getElementById('conversion-section').classList.add('hidden');
                    document.querySelector('.results-card').classList.remove('hidden');
                    document.querySelector('.results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 2000);

            } catch (err) {
                // Fallback: store locally
                const leads = JSON.parse(localStorage.getItem('valomaison_leads') || '[]');
                leads.push(data);
                localStorage.setItem('valomaison_leads', JSON.stringify(leads));

                // Track callback submit (fallback)
                if (window.EITracker && window.EITracker.track) {
                    window.EITracker.track('callback_submit', { projet: data.projet, fallback: true });
                }

                document.getElementById('callback-form-container').classList.add('hidden');
                document.getElementById('lead-success').classList.remove('hidden');
                document.getElementById('success-message').textContent =
                    'Demande enregistr√©e ! Un conseiller vous rappellera bient√¥t.';

                // Show estimation after delay
                setTimeout(function() {
                    document.getElementById('conversion-section').classList.add('hidden');
                    document.querySelector('.results-card').classList.remove('hidden');
                    document.querySelector('.results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 2000);
            }
        });

        // Visit form submission
        document.getElementById('visit-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            log('Soumission formulaire visite...');

            const formData = new FormData(this);
            const data = {
                type: 'visit',
                nom: formData.get('nom'),
                prenom: formData.get('prenom'),
                telephone: formData.get('telephone'),
                email: formData.get('email'),
                adresse: formData.get('adresse'),
                date_souhaitee: formData.get('date'),
                creneau: formData.get('creneau'),
                message: formData.get('message') || null,
                estimation_data: getCurrentEstimation(),
                date_demande: new Date().toISOString()
            };

            log('Donn√©es lead visite:', data);

            try {
                // Send to backend API
                log('Envoi vers /api/leads...');
                const response = await fetch('/api/leads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                log('R√©ponse /api/leads:', result);

                if (!response.ok) throw new Error(result.message || 'Erreur serveur');

                // Track visit submit
                if (window.EITracker && window.EITracker.track) {
                    window.EITracker.track('visit_submit');
                }

                // Show success then estimation
                document.getElementById('visit-form-container').classList.add('hidden');
                document.getElementById('lead-success').classList.remove('hidden');
                document.getElementById('success-message').textContent =
                    'Visite programm√©e ! Vous recevrez une confirmation par email √† ' + data.email;

                // Show estimation after delay
                setTimeout(function() {
                    document.getElementById('conversion-section').classList.add('hidden');
                    document.querySelector('.results-card').classList.remove('hidden');
                    document.querySelector('.results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 2000);

            } catch (err) {
                // Fallback: store locally
                const leads = JSON.parse(localStorage.getItem('valomaison_leads') || '[]');
                leads.push(data);
                localStorage.setItem('valomaison_leads', JSON.stringify(leads));

                // Track visit submit (fallback)
                if (window.EITracker && window.EITracker.track) {
                    window.EITracker.track('visit_submit', { fallback: true });
                }

                document.getElementById('visit-form-container').classList.add('hidden');
                document.getElementById('lead-success').classList.remove('hidden');
                document.getElementById('success-message').textContent =
                    'Demande de visite enregistr√©e ! Un conseiller vous contactera pour confirmer.';

                // Show estimation after delay
                setTimeout(function() {
                    document.getElementById('conversion-section').classList.add('hidden');
                    document.querySelector('.results-card').classList.remove('hidden');
                    document.querySelector('.results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 2000);
            }
        });
    </script>
    <script src="{{ url_for('static', filename='tracker.js') }}" defer></script>
</body>
</html>
